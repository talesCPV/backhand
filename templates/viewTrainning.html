<title></title>
<template>
    <style>
        #map{
            width: 100%;
            height: 200px;
            max-width: 500px;
        }

        p{
            text-indent: 0;
        }

        h2, p{
            padding: 0 20px;
        }

        .line{
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            padding: 0 10px;
            margin: 10px;
        }

        .center{
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
        }


        .view-sets{
            align-items: center;
            display: flex;
            flex-direction: column;
            font-weight: bold;
            cursor: zoom-in;
        }
                


    </style>

    <div class="form">
        <div class="line">
            <p id="atv-atleta"></p>

        </div>
        <div class="center" >
            <h2 id="atv-titulo"></h2>
            <div id="map"></div>
        </div>
        <div class="line">
            <p id="atv-data"></p>
            <p id="atv-hora"></p>
            <p id="atv-tempo"></p>
        </div>
        <div class="view-sets"></div>
        <div class="line">
            <button id="btnEdit" class="btn btn-primary">EDIT</button>
            <button id="btnDel" class="btn btn-primary">Delete</button>
        </div>
        

    </div>




</template>
<script>
    
    const data = mainData.viewTrainning.data
    console.log(data)

    fillSets() 

    document.querySelector('.title-viewTrainning').innerHTML = data.EVENTO
    document.querySelector('#atv-atleta').innerHTML = `${data.nick} ${data.SETS_P1} vs ${data.SETS_P2} ${data.parceiro.split(' ')[0]}`
    document.querySelector('#atv-titulo').innerHTML = data.nome
    document.querySelector('#atv-data').innerHTML = `date: ${data.dia.showDate()}`
    document.querySelector('#atv-hora').innerHTML = `time: ${data.dia.showTime()}`
    document.querySelector('#atv-tempo').innerHTML = `elapsed time: ${parseInt(data.duracao/60).toString().padStart(2,'0')}:${parseInt(data.duracao%60).toString().padStart(2,'0')}`



    if(data.id_usuario != localStorage.getItem('idUser')){
        document.querySelector('#btnEdit').style.display = 'none'
        document.querySelector('#btnDel').style.display = 'none'
    }

    map = createMap('map',[data.lat, data.lng])
    pinMap([data.lat, data.lng],map)
    map.locate({setView: false, maxZoom: 30})
    disableMap(map)


    document.querySelector('#btnEdit').addEventListener('click',()=>{
        openHTML('newActivity.html','modal',data,400)
    })

    document.querySelector('#btnDel').addEventListener('click',()=>{
        if(confirm('Do you realy wanna delete this trainning?')){
            const params = new Object;
                params.id_ATV = mainData.viewTrainning.data.id

            const myPromisse = queryDB(params,11);
            myPromisse.then(()=>{
                const form = document.getElementById(mainData.viewTrainning.data.form)
                form.parentNode.removeChild( form )
                closeModal('')
            })



        }
    })



    function fillSets(){
        const params = new Object;
            params.id_ATV = data.id

        const myPromisse = queryDB(params,15);
        myPromisse.then((result)=>{
            data.sets = JSON.parse(result)
            for(let i=0; i<data.sets.length; i++){
                const p = document.createElement('p')
                p.innerHTML = 'SET '+(i+1).toString().padStart(2,0) + ' - '+data.sets[i].p1_score.padStart(2,0)+' x '+data.sets[i].p2_score.padStart(2,0)
                p.title = data.sets[i].obs
                document.querySelector('.view-sets').appendChild(p)
            }            
        })
    }



</script>